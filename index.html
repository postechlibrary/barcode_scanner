<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š ë„ì„œê´€ ì¥ì„œì ê²€ ìŠ¤ìºë„ˆ</title>
    <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .scanner-area {
            position: relative;
            padding: 20px;
        }
        
        #video {
            width: 100%;
            max-width: 100%;
            border-radius: 10px;
            border: 3px solid #4CAF50;
        }
        
        .controls {
            padding: 0 20px 20px;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-primary:hover {
            background: #45a049;
        }
        
        .btn-secondary {
            background: #2196F3;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #1976D2;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn-danger:hover {
            background: #d32f2f;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            padding: 15px 20px;
            background: #f5f5f5;
            border-top: 1px solid #ddd;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        .scan-list {
            max-height: 300px;
            overflow-y: auto;
            padding: 20px;
            border-top: 1px solid #ddd;
        }
        
        .scan-item {
            background: #f9f9f9;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
            font-family: monospace;
            font-size: 14px;
        }
        
        .scan-time {
            color: #666;
            font-size: 12px;
        }
        
        .settings {
            padding: 20px;
            border-top: 1px solid #ddd;
            background: #fafafa;
        }
        
        .setting-item {
            margin: 10px 0;
        }
        
        .setting-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .setting-item input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
        
        .success-message {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
        
        .toggle-btn {
            background: none;
            border: none;
            color: #2196F3;
            cursor: pointer;
            text-decoration: underline;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š ë„ì„œê´€ ì¥ì„œì ê²€</h1>
            <p>ë°”ì½”ë“œ ìŠ¤ìºë„ˆ</p>
        </div>
        
        <div class="scanner-area">
            <video id="video" autoplay muted playsinline></video>
            <canvas id="canvas" style="display: none;"></canvas>
        </div>
        
        <div class="controls">
            <button id="startBtn" class="btn btn-primary">ğŸ“· ìŠ¤ìº” ì‹œì‘</button>
            <button id="stopBtn" class="btn btn-danger" style="display: none;">â¹ï¸ ìŠ¤ìº” ì¤‘ì§€</button>
            <button id="exportBtn" class="btn btn-secondary">ğŸ’¾ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
            <button id="clearBtn" class="btn btn-danger">ğŸ—‘ï¸ ëª©ë¡ ì§€ìš°ê¸°</button>
            <button class="toggle-btn" onclick="toggleSettings()">âš™ï¸ ì„¤ì •</button>
        </div>
        
        <div class="error-message" id="errorMsg"></div>
        <div class="success-message" id="successMsg"></div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="totalCount">0</div>
                <div class="stat-label">ğŸ“Š ì´ ìŠ¤ìº”</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="validCount">0</div>
                <div class="stat-label">âœ… ìœ íš¨</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="duplicateCount">0</div>
                <div class="stat-label">ğŸ”„ ì¤‘ë³µ</div>
            </div>
        </div>
        
        <div id="settingsPanel" class="settings" style="display: none;">
            <div class="setting-item">
                <label>ğŸ“ ë°”ì½”ë“œ ì‹œì‘ ë¬¸ì (ìœ íš¨ì„± ê²€ì‚¬):</label>
                <input type="text" id="prefixSetting" value="M" placeholder="ì˜ˆ: M, LIB, 20">
            </div>
            <div class="setting-item">
                <label>ğŸ”¢ ìµœì†Œ ë°”ì½”ë“œ ê¸¸ì´:</label>
                <input type="number" id="minLengthSetting" value="8" min="1">
            </div>
            <div class="setting-item">
                <label>ğŸ”Š ì•Œë¦¼ìŒ í™œì„±í™”:</label>
                <input type="checkbox" id="soundSetting" checked>
            </div>
        </div>
        
        <div class="scan-list" id="scanList">
            <p style="text-align: center; color: #666;">ğŸ“‹ ìŠ¤ìº”ëœ ë°”ì½”ë“œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
        </div>
    </div>

    <script>
        class LibraryBarcodeScanner {
            constructor() {
                this.scannedCodes = new Set();
                this.scanHistory = [];
                this.duplicateAttempts = 0; // ì¤‘ë³µ ì‹œë„ íšŸìˆ˜ ì¶”ê°€
                this.isScanning = false;
                this.codeReader = null;
                this.stream = null;
                
                this.initializeElements();
                this.initializeEventListeners();
                this.initializeCodeReader();
            }
            
            initializeElements() {
                this.video = document.getElementById('video');
                this.startBtn = document.getElementById('startBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.exportBtn = document.getElementById('exportBtn');
                this.clearBtn = document.getElementById('clearBtn');
                this.scanList = document.getElementById('scanList');
                this.totalCount = document.getElementById('totalCount');
                this.validCount = document.getElementById('validCount');
                this.duplicateCount = document.getElementById('duplicateCount');
                this.errorMsg = document.getElementById('errorMsg');
                this.successMsg = document.getElementById('successMsg');
                this.prefixSetting = document.getElementById('prefixSetting');
                this.minLengthSetting = document.getElementById('minLengthSetting');
                this.soundSetting = document.getElementById('soundSetting');
            }
            
            initializeEventListeners() {
                this.startBtn.addEventListener('click', () => this.startScanning());
                this.stopBtn.addEventListener('click', () => this.stopScanning());
                this.exportBtn.addEventListener('click', () => this.exportData());
                this.clearBtn.addEventListener('click', () => this.clearData());
            }
            
            initializeCodeReader() {
                this.codeReader = new ZXing.BrowserMultiFormatReader();
            }
            
            async startScanning() {
                try {
                    this.hideMessages();
                    
                    // ì´ì „ ìŠ¤ìº”ì´ ìˆë‹¤ë©´ ì •ë¦¬
                    if (this.codeReader) {
                        this.codeReader.reset();
                    }
                    
                    this.isScanning = true;
                    this.startBtn.style.display = 'none';
                    this.stopBtn.style.display = 'block';
                    
                    // ZXingì„ ì‚¬ìš©í•œ ì—°ì† ë°”ì½”ë“œ ìŠ¤ìº”
                    this.codeReader.decodeFromVideoDevice(null, 'video', (result, err) => {
                        if (result) {
                            this.processBarcodeResult(result.text);
                        }
                        // ì—ëŸ¬ëŠ” ë°”ì½”ë“œê°€ ê°ì§€ë˜ì§€ ì•ŠëŠ” ì •ìƒì ì¸ ìƒí™©ì´ë¯€ë¡œ ë¬´ì‹œ
                    });
                    
                    this.showSuccess('ğŸ“· ìŠ¤ìº”ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    
                } catch (error) {
                    this.showError('ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨: ' + error.message);
                    this.resetUI();
                }
            }
            
            async scanContinuously() {
                if (!this.isScanning) return;
                
                try {
                    const result = await this.codeReader.decodeOnceFromVideoDevice(undefined, 'video');
                    if (result) {
                        this.processBarcodeResult(result.text);
                    }
                } catch (error) {
                    // ë°”ì½”ë“œê°€ ê°ì§€ë˜ì§€ ì•Šì€ ê²½ìš°ëŠ” ì •ìƒì´ë¯€ë¡œ ë¬´ì‹œ
                }
                
                // ì—°ì† ìŠ¤ìº”ì„ ìœ„í•´ ì¬ê·€ í˜¸ì¶œ (100ms ê°„ê²©)
                if (this.isScanning) {
                    setTimeout(() => this.scanContinuously(), 100);
                }
            }
            
            processBarcodeResult(barcode) {
                const now = new Date();
                const timeString = now.toLocaleString('ko-KR');
                
                // ìœ íš¨ì„± ê²€ì‚¬
                const prefix = this.prefixSetting.value.trim();
                const minLength = parseInt(this.minLengthSetting.value);
                
                let isValid = true;
                let errorReason = '';
                
                if (prefix && !barcode.startsWith(prefix)) {
                    isValid = false;
                    errorReason = `ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì‹œì‘ ë¬¸ì (${prefix}ë¡œ ì‹œì‘í•´ì•¼ í•¨)`;
                }
                
                if (barcode.length < minLength) {
                    isValid = false;
                    errorReason = `ë°”ì½”ë“œ ê¸¸ì´ê°€ ë„ˆë¬´ ì§§ìŒ (ìµœì†Œ ${minLength}ì)`;
                }
                
                if (!isValid) {
                    this.playErrorSound();
                    this.showError(`âŒ ${errorReason}: ${barcode}`);
                    return;
                }
                
                // ì¤‘ë³µ ê²€ì‚¬
                const isDuplicate = this.scannedCodes.has(barcode);
                
                if (isDuplicate) {
                    this.duplicateAttempts++;
                    this.playErrorSound();
                    this.showError(`ğŸ”„ ì¤‘ë³µëœ ë°”ì½”ë“œ: ${barcode}`);
                    this.updateStats();
                    return;
                }
                
                // ì„±ê³µì ìœ¼ë¡œ ìŠ¤ìº”ë¨
                this.scannedCodes.add(barcode);
                this.scanHistory.push({
                    barcode: barcode,
                    timestamp: now,
                    timeString: timeString
                });
                
                this.playSuccessSound();
                this.updateScanList();
                this.updateStats();
                this.showSuccess(`âœ… ìŠ¤ìº” ì™„ë£Œ: ${barcode}`);
            }
            
            stopScanning() {
                this.isScanning = false;
                
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                }
                
                this.startBtn.style.display = 'block';
                this.stopBtn.style.display = 'none';
                
                this.showSuccess('â¹ï¸ ìŠ¤ìº”ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤');
            }
            
            updateScanList() {
                if (this.scanHistory.length === 0) {
                    this.scanList.innerHTML = '<p style="text-align: center; color: #666;">ğŸ“‹ ìŠ¤ìº”ëœ ë°”ì½”ë“œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>';
                    return;
                }
                
                this.scanList.innerHTML = this.scanHistory
                    .slice(-50) // ìµœê·¼ 50ê°œë§Œ í‘œì‹œ
                    .reverse()
                    .map(item => `
                        <div class="scan-item">
                            <div>${item.barcode}</div>
                            <div class="scan-time">â° ${item.timeString}</div>
                        </div>
                    `).join('');
            }
            
            updateStats() {
                this.totalCount.textContent = this.scanHistory.length;
                this.validCount.textContent = this.scannedCodes.size;
                this.duplicateCount.textContent = this.scanHistory.length - this.scannedCodes.size;
            }
            
            exportData() {
                if (this.scanHistory.length === 0) {
                    this.showError('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                
                const csvContent = [
                    'ë°”ì½”ë“œ,ìŠ¤ìº”ì‹œê°„,ë‚ ì§œ,ì‹œê°„',
                    ...this.scanHistory.map(item => 
                        `"${item.barcode}","${item.timeString}","${item.timestamp.toLocaleDateString('ko-KR')}","${item.timestamp.toLocaleTimeString('ko-KR')}"`
                    )
                ].join('\n');
                
                // ëª¨ë°”ì¼ì—ì„œ ë” ì•ˆì •ì ì¸ ë°©ë²•ìœ¼ë¡œ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                this.showExportModal(csvContent);
            }
            
            showExportModal(csvContent) {
                // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
                const existingModal = document.getElementById('exportModal');
                if (existingModal) {
                    existingModal.remove();
                }
                
                // ëª¨ë‹¬ ìƒì„±
                const modal = document.createElement('div');
                modal.id = 'exportModal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    z-index: 1000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    padding: 20px;
                `;
                
                modal.innerHTML = `
                    <div style="
                        background: white;
                        border-radius: 10px;
                        padding: 20px;
                        width: 100%;
                        max-width: 500px;
                        max-height: 80vh;
                        overflow: hidden;
                        display: flex;
                        flex-direction: column;
                    ">
                        <h3 style="margin: 0 0 15px 0; text-align: center;">ğŸ“Š ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h3>
                        
                        <div style="margin-bottom: 15px;">
                            <button onclick="scanner.copyToClipboard('${csvContent.replace(/'/g, "\\'")}', this)" 
                                    style="width: 100%; padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 5px; margin: 5px 0; cursor: pointer;">
                                ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬
                            </button>
                            
                            <button onclick="scanner.downloadCSV('${csvContent.replace(/'/g, "\\'")}', this)" 
                                    style="width: 100%; padding: 12px; background: #2196F3; color: white; border: none; border-radius: 5px; margin: 5px 0; cursor: pointer;">
                                ğŸ’¾ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                            </button>
                            
                            <button onclick="scanner.shareData('${csvContent.replace(/'/g, "\\'")}', this)" 
                                    style="width: 100%; padding: 12px; background: #FF9800; color: white; border: none; border-radius: 5px; margin: 5px 0; cursor: pointer;">
                                ğŸ“¤ ê³µìœ í•˜ê¸°
                            </button>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ğŸ“„ CSV ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°:</label>
                            <textarea id="csvPreview" readonly style="
                                width: 100%;
                                height: 200px;
                                padding: 10px;
                                border: 1px solid #ddd;
                                border-radius: 5px;
                                font-family: monospace;
                                font-size: 12px;
                                resize: none;
                            ">${csvContent}</textarea>
                        </div>
                        
                        <button onclick="scanner.closeExportModal()" 
                                style="padding: 10px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            âŒ ë‹«ê¸°
                        </button>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        this.closeExportModal();
                    }
                });
            }
            
            async copyToClipboard(csvContent, button) {
                try {
                    if (navigator.clipboard) {
                        await navigator.clipboard.writeText(csvContent);
                        this.showTemporarySuccess(button, 'âœ… ë³µì‚¬ë¨!');
                        this.showSuccess('ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
                    } else {
                        // êµ¬í˜• ë¸Œë¼ìš°ì € ëŒ€ì•ˆ
                        const textArea = document.getElementById('csvPreview');
                        textArea.select();
                        textArea.setSelectionRange(0, 99999);
                        document.execCommand('copy');
                        this.showTemporarySuccess(button, 'âœ… ë³µì‚¬ë¨!');
                        this.showSuccess('ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
                    }
                } catch (error) {
                    this.showError('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨. í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì„ íƒí•´ì„œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
                }
            }
            
            downloadCSV(csvContent, button) {
                try {
                    const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    
                    link.href = url;
                    link.download = `ì¥ì„œì ê²€_${new Date().toISOString().slice(0,10)}.csv`;
                    link.style.display = 'none';
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    this.showTemporarySuccess(button, 'âœ… ë‹¤ìš´ë¡œë“œ!');
                    this.showSuccess(`ğŸ’¾ ${this.scanHistory.length}ê°œ í•­ëª©ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤`);
                } catch (error) {
                    this.showError('íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨. í´ë¦½ë³´ë“œ ë³µì‚¬ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.');
                }
            }
            
            shareData(csvContent, button) {
                if (navigator.share) {
                    const fileName = `ì¥ì„œì ê²€_${new Date().toISOString().slice(0,10)}.csv`;
                    navigator.share({
                        title: 'ğŸ“š ë„ì„œê´€ ì¥ì„œì ê²€ ê²°ê³¼',
                        text: `ì¥ì„œì ê²€ ê²°ê³¼ (${this.scanHistory.length}ê°œ í•­ëª©)\n\n${csvContent}`,
                        files: [new File(['\uFEFF' + csvContent], fileName, { type: 'text/csv' })]
                    }).then(() => {
                        this.showTemporarySuccess(button, 'âœ… ê³µìœ ë¨!');
                    }).catch(() => {
                        // íŒŒì¼ ê³µìœ  ì‹¤íŒ¨ì‹œ í…ìŠ¤íŠ¸ë§Œ ê³µìœ 
                        navigator.share({
                            title: 'ğŸ“š ë„ì„œê´€ ì¥ì„œì ê²€ ê²°ê³¼',
                            text: `ì¥ì„œì ê²€ ê²°ê³¼ (${this.scanHistory.length}ê°œ í•­ëª©)\n\n${csvContent.substring(0, 1000)}...`
                        }).then(() => {
                            this.showTemporarySuccess(button, 'âœ… ê³µìœ ë¨!');
                        }).catch(() => {
                            this.showError('ê³µìœ  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í´ë¦½ë³´ë“œ ë³µì‚¬ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.');
                        });
                    });
                } else {
                    this.showError('ê³µìœ  ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤. í´ë¦½ë³´ë“œ ë³µì‚¬ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.');
                }
            }
            
            showTemporarySuccess(button, message) {
                const originalText = button.textContent;
                button.textContent = message;
                button.style.background = '#4CAF50';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            }
            
            closeExportModal() {
                const modal = document.getElementById('exportModal');
                if (modal) {
                    modal.remove();
                }
            }
            
            clearData() {
                if (confirm('ğŸ—‘ï¸ ëª¨ë“  ìŠ¤ìº” ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    this.scannedCodes.clear();
                    this.scanHistory = [];
                    this.updateScanList();
                    this.updateStats();
                    this.showSuccess('ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            }
            
            playSuccessSound() {
                if (this.soundSetting.checked) {
                    this.playBeep(800, 100);
                }
            }
            
            playErrorSound() {
                if (this.soundSetting.checked) {
                    this.playBeep(400, 200);
                }
            }
            
            playBeep(frequency, duration) {
                if (typeof(AudioContext) !== "undefined" || typeof(webkitAudioContext) !== "undefined") {
                    const context = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = context.createOscillator();
                    const gainNode = context.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(context.destination);
                    
                    oscillator.frequency.value = frequency;
                    gainNode.gain.setValueAtTime(0.3, context.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + duration / 1000);
                    
                    oscillator.start(context.currentTime);
                    oscillator.stop(context.currentTime + duration / 1000);
                }
            }
            
            showError(message) {
                this.errorMsg.textContent = message;
                this.errorMsg.style.display = 'block';
                this.successMsg.style.display = 'none';
                setTimeout(() => this.hideMessages(), 3000);
            }
            
            showSuccess(message) {
                this.successMsg.textContent = message;
                this.successMsg.style.display = 'block';
                this.errorMsg.style.display = 'none';
                setTimeout(() => this.hideMessages(), 2000);
            }
            
            hideMessages() {
                this.errorMsg.style.display = 'none';
                this.successMsg.style.display = 'none';
            }
        }
        
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        // ì•± ì´ˆê¸°í™”
        let scanner;
        
        window.addEventListener('load', () => {
            scanner = new LibraryBarcodeScanner();
            scanner.updateStats(); // ì´ˆê¸° í†µê³„ í‘œì‹œ
        });
        
        // PWA ì§€ì›ì„ ìœ„í•œ ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
